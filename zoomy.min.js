(function(f){var b={count:[],pos:null};f.fn.zoomy=function(g,e){var p="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?!0:!1,s=p?"touchstart":"click",m={pos:{stop:function(a,b,c,j){return a-b-c+j},mouse:function(a,b,c){return a-b-c},zoom:function(a,b,c,j,e){return(a-b)/c-j+e}},css:function(a){return"undefined"!==typeof a&&0<a.length?{backgroundPosition:"-"+a[0]+"px -"+a[1]+"px","-webkit-transform":"translate("+a[2]+"px, "+a[3]+"px )"}:{}},ratio:function(a,b){return a/
b},setParams:function(a){a=a.attr("rel");b[a].size={};b[a].size.full=e.zoomSize+2*b[a].zoom.border;b[a].size.half=b[a].size.full/2;b[a].size.ratioX=m.ratio(b[a].css.width,b[a].zoom.x);b[a].size.ratioY=m.ratio(b[a].css.height,b[a].zoom.y);b[a].size.zoomX=b[a].zoom.x-b[a].size.full;b[a].size.zoomY=b[a].zoom.y-b[a].size.full;b[a].stop={};b[a].stop.main=b[a].size.half-b[a].size.half*b[a].size.ratioX-b[a].zoom.border*b[a].size.ratioX+b[a].zoom.border;b[a].stop.right=m.pos.stop(b[a].css.width,b[a].size.full,
b[a].zoom.border,b[a].stop.main);b[a].stop.bottom=m.pos.stop(b[a].css.height,b[a].size.full,b[a].zoom.border,b[a].stop.main)}},l={move:function(a,d,c){var e=d.attr("rel"),f=a.offset();a=b[e];var k=p?-70:0,h=m.pos.mouse(c.pageX,f.left,a.size.half),n=m.pos.mouse(c.pageY+k,f.top,a.size.half),g=m.pos.zoom(c.pageX,f.left,a.size.ratioX,a.size.half,b[e].zoom.border);c=m.pos.zoom(c.pageY+k,f.top,a.size.ratioY,a.size.half,b[e].zoom.border);var e=-a.stop.main>h,f=-a.stop.main<=n,k=-a.stop.main>n,l=a.stop.bottom>
n,r=a.stop.bottom<=n,t=a.stop.right>h,q=a.stop.right<=h;a=m.css({"0":[g,c,h,n],1:[0,c,-a.stop.main,n],2:[0,0,-a.stop.main,-a.stop.main],3:[0,a.size.zoomY,-a.stop.main,a.stop.bottom],4:[g,0,h,-a.stop.main],5:[a.size.zoomX,0,a.stop.right,-a.stop.main],6:[a.size.zoomX,c,a.stop.right,n],7:[a.size.zoomX,a.size.zoomY,a.stop.right,a.stop.bottom],8:[g,a.size.zoomY,h,a.stop.bottom]}[-a.stop.main<=h&&f&&t&&l?0:e?f&&l?1:k?2:r?3:null:k?t?4:5:q?l?6:7:r?8:null]);d.css(a||{})},classes:function(a){var d=a.find(".zoomy").attr("rel");
0===b[d].state||null===b[d].state?a.removeClass("inactive"):a.addClass("inactive")},enter:function(a,d){var c=d.attr("rel");b[c].state=1;d.css("visibility","visible");l.classes(a)},leave:function(a,d,c){var e=d.attr("rel");b[e].state=null!==c?null:0;d.css("visibility","hidden");l.classes(a)},callback:function(a,d){var c=d.attr("rel");null!==a&&"function"===typeof a&&a(f.extend({},b[c],b.pos))}},r={round:function(a){return!e.round?0:void 0===a?"100%":e.zoomSize/2+"px "+e.zoomSize/2+"px 0px 0px"},glare:function(a){a.children("span").css({height:e.zoomSize/
2,width:e.zoomSize-10,margin:f.browser.msie&&9===parseInt(f.browser.version,10)?0:"5px auto","border-radius":r.round(0)})},border:function(){var a=e.border.replace(/^\s*|\s*$/g,""),b=a.split(" "),c=parseFloat(b[0]);return[a,2<b.length&&1*c===c?c:0]},params:function(a,d){var c=a.children("img"),j=r.border(d),g={marginTop:c.css("margin-top"),marginRight:c.css("margin-right"),marginBottom:c.css("margin-bottom"),marginLeft:c.css("margin-left")},k={"float":c.css("float")},h={display:"block",height:c.height(),
width:c.width(),position:"relative"},n=d.attr("rel"),l={};"none"===k["float"]&&"center"===a.parent("*:first").css("text-align")&&(g.marginRight="auto",g.marginLeft="auto");f.extend(l,g,k,h);b[n].css=l;e.glare||d.children("span").css({height:e.zoomSize-10,width:e.zoomSize-10});d.css({height:e.zoomSize,width:e.zoomSize,top:0,left:0,"border-radius":r.round(void 0,j[1]),border:j[0]});c.css("margin","0px");c.one("load",function(){a.css(b[n].css);a.parent(".zoomy-wrap").length&&a.parent(".zoomy-wrap").css(b[n].css)}).each(function(){(this.complete||
f.browser.msie&&6===parseInt(f.browser.version,10))&&f(this).trigger("load")})}},u={image:function(a,d){var c=d.attr("rel");d.show();d.find("img").attr("src")!==a&&d.find("img").attr("src",a).load(function(){var f=e.glare?"<span/>":"",g=r.border(d);b[c].zoom={x:d.find("img").width(),y:d.find("img").height(),border:g[1]};d.append(f).css({"background-image":"url("+a+")"}).find("img").remove();r.glare(d);m.setParams(d)}).each(function(){(this.complete||f.browser.msie&&6===parseInt(f.browser.version,
10))&&f(this).trigger("load")})},zoom:function(a,d){b[d]={state:null,index:d};b.count.push(0);var c="string"===typeof a.attr(e.attr)&&"href"!==e.attr?a.attr(e.attr):a.attr("href"),j=null,m=e.zoomInit,k=p?['<div class="zoomy-wrap" />','<div class=" zoomy-btn zoomy-btn-'+d+'"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="40px" height="40px" viewBox="0 0 50 50" overflow="inherit" xml:space="preserve">                <defs>                  <filter id="drop-shadow">                    <feGaussianBlur in="SourceAlpha" result="blur-out" stdDeviation="1" />                    <feOffset in="blur-out" result="the-shadow" dx="0" dy="1"/>                    <feBlend in="SourceGraphic" in2="the-shadow" mode="normal"/>                  </filter>                </defs>                <path filter="url(#drop-shadow)" fill="#efefef" d="M23.265,30.324l-9.887,9.887l-3.64-3.641l9.942-9.941c-2.687-4.42-2.134-10.246,1.668-14.049 c4.469-4.469,11.732-4.451,16.224,0.04c4.491,4.491,4.509,11.754,0.04,16.224C33.723,32.732,27.718,33.223,23.265,30.324z M24.601,15.833c-2.681,2.681-2.67,7.039,0.024,9.733s7.053,2.705,9.733,0.025c2.682-2.681,2.671-7.04-0.023-9.734 C31.641,13.162,27.282,13.152,24.601,15.833z"/>              </svg>touch</div>']:
["",""];a.addClass("parent-zoom").wrap(k[0]).append('<div class="zoomy zoom-obj-'+d+'" rel="'+d+'"><img id="tmp"/></div>').after(k[1]);var j=f(".zoom-obj-"+d),h=[],n=p?"touchmove":"mousemove",k=p?"touchstart":"mouseover",s=p?"touchend":"mouseleave",v=function(b,d){b=p?d?d.touches[0]||d.changedTouches[0]:b.originalEvent.touches[0]||b.originalEvent.changedTouches[0]:b;l.move(a,j,b)},w=function(){l.enter(a,j);a.bind(n,v);l.callback(e.zoomStart,j)},t=function(b){l.leave(a,j,b);a.unbind(n,v);l.callback(e.zoomStop,
j)},q=function(a,c){a=p?c?c.touches[0]||c.changedTouches[0]:a.originalEvent.touches[0]||a.originalEvent.changedTouches[0]:a;b.pos=a;0===b[d].state&&w()},x=function(a){b.pos=a;1===b[d].state&&t(null)},q={event:function(c){b.pos=c;e.clickable||c.preventDefault();0===b[d].state||null===b[d].state?(w(),c=p&&"object"===typeof c.originalEvent?c.originalEvent.changedTouches[0]||c.originalEvent.touches[0]:c,l.move(a,j,c)):1===b[d].state&&("mouseover"!==g&&"mouseenter"!==g)&&t(0)},mouseover:q,mouseleave:x,
touchstart:q,touchend:x,click:function(a){a.preventDefault();a.stopPropagation()}};"mouseover"===g||"touchstart"===g?h[g]=q.event:(h[g]=q.event,h[k]=q[k]);!e.clickable&&"click"!==g&&(h.click=q.click);h[s]=q[s];if(p){var k=f(".zoomy-btn-"+d),y=k.parent("div");k.bind({touchstart:function(b){a.bind(h);a.trigger("touchstart",b.originalEvent);a.trigger("touchmove",b.originalEvent);y.addClass("active")},touchmove:function(b){b.preventDefault();a.trigger("touchmove",b.originalEvent)},touchend:function(){y.removeClass("active");
a.trigger("touchend");a.unbind(h)}});document.oncontextmenu=function(){return!1};f(document).mousedown(function(a){return 2==a.button?!1:!0})}else a.bind(h);f(window).resize(function(){a.attr("style","").parent(".zoomy-wrap").attr("style","");window.setTimeout(function(){r.params(a,j)},100)});null!==m&&"function"===typeof m&&m(a);r.params(a,j);u.image(c,j)},init:function(a,d){f("<img />").attr("src",d.attr("src")).one("load",function(){u.zoom(a,b.count.length)}).each(function(){(this.complete||f.browser.msie&&
6===parseInt(f.browser.version,10))&&f(this).trigger("load")})}};"object"===typeof g&&void 0===e?(e=g,g=s):void 0===g&&(g=s);e=f.extend({zoomSize:200,round:!0,glare:!0,clickable:!1,attr:"href",border:"5px solid #999",zoomInit:null,zoomStart:null,zoomStop:null},e);f(this).each(function(){var a=f(this),b=a.find("img");u.init(a,b)})}})(jQuery);